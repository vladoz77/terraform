# üõ°Ô∏è –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ HashiCorp Vault –∫–∞–∫ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ —Å–µ–∫—Ä–µ—Ç–æ–≤ –≤ Ansible

> **–¶–µ–ª—å**: –ù–∞—É—á–∏—Ç—å—Å—è –±–µ–∑–æ–ø–∞—Å–Ω–æ —Ö—Ä–∞–Ω–∏—Ç—å –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–ª–æ–≥–∏–Ω—ã, –ø–∞—Ä–æ–ª–∏, —Ç–æ–∫–µ–Ω—ã –∏ —Ç.–¥.) –≤ Ansible-–ø–ª–µ–π–±—É–∫–∞—Ö, –∏–∑–≤–ª–µ–∫–∞—è –∏—Ö –∏–∑ HashiCorp Vault —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –º–µ—Ö–∞–Ω–∏–∑–º–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ **AppRole**.

---

## üîß –ß–∞—Å—Ç—å 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ HashiCorp Vault

### 1.1. –í–∫–ª—é—á–µ–Ω–∏–µ —Å–µ–∫—Ä–µ—Ç–Ω–æ–≥–æ –¥–≤–∏–∂–∫–∞ KV (Key-Value)

HashiCorp Vault –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ç–∏–ø–æ–≤ —Å–µ–∫—Ä–µ—Ç–Ω—ã—Ö –¥–≤–∏–∂–∫–æ–≤. –î–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Å–µ–∫—Ä–µ—Ç–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —É—á—ë—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö) –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **KV (Key-Value)**, –≤–µ—Ä—Å–∏–∏ 2 —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.

```bash
vault secrets enable -path=ansible kv-v2
```

- `-path=ansible` ‚Äî –ø—É—Ç—å, –ø–æ –∫–æ—Ç–æ—Ä–æ–º—É –±—É–¥—É—Ç —Ö—Ä–∞–Ω–∏—Ç—å—Å—è —Å–µ–∫—Ä–µ—Ç—ã. –í—ã –º–æ–∂–µ—Ç–µ –≤—ã–±—Ä–∞—Ç—å –ª—é–±–æ–µ –∏–º—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, `secrets/ansible`), –Ω–æ –æ–Ω–æ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–º.
- `kv-v2` ‚Äî –≤—Ç–æ—Ä–∞—è –≤–µ—Ä—Å–∏—è KV-–¥–≤–∏–∂–∫–∞, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—â–∞—è –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–µ–∫—Ä–µ—Ç–æ–≤ –∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ.

> üí° **–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ**: –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ Vault –∑–∞–ø—É—â–µ–Ω –∏ –≤—ã –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, —á–µ—Ä–µ–∑ `vault login`).

---

### 1.2. –ó–∞–ø–∏—Å—å —Å–µ–∫—Ä–µ—Ç–∞

–°–æ–∑–¥–∞–¥–∏–º —Å–µ–∫—Ä–µ—Ç —Å —É—á—ë—Ç–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –¥–ª—è Nexus:

```bash
vault kv put ansible/nexus nexus_username=jenkins nexus_password=password
```

- `ansible/nexus` ‚Äî –ø—É—Ç—å –∫ —Å–µ–∫—Ä–µ—Ç—É –≤–Ω—É—Ç—Ä–∏ –¥–≤–∏–∂–∫–∞ KV.
- `nexus_username`, `nexus_password` ‚Äî –∫–ª—é—á–∏ –∏ –∑–Ω–∞—á–µ–Ω–∏—è —Å–µ–∫—Ä–µ—Ç–∞.

> üîí **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è**: –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ä–µ–∞–ª—å–Ω—ã–µ –ø–∞—Ä–æ–ª–∏ –≤ –ø—Ä–∏–º–µ—Ä–∞—Ö. –í –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –Ω–∞–¥—ë–∂–Ω—ã–µ, –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º—ã–µ –ø–∞—Ä–æ–ª–∏ –∏–ª–∏ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ç–æ–∫–µ–Ω—ã.

–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ:

```bash
vault kv get ansible/nexus
```

–û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥:

```
========= Data =========
Key               Value
---               -----
nexus_password    password
nexus_username    jenkins
```

---

### 1.3. –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª–∏—Ç–∏–∫–∏ –¥–æ—Å—Ç—É–ø–∞

–î–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ —Å–µ–∫—Ä–µ—Ç–∞–º —Å–æ–∑–¥–∞—ë—Ç—Å—è **–ø–æ–ª–∏—Ç–∏–∫–∞**, –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞—é—â–∞—è –ø—Ä–∞–≤–∞ —Ç–æ–ª—å–∫–æ –Ω–∞ —á—Ç–µ–Ω–∏–µ –Ω—É–∂–Ω—ã—Ö –ø—É—Ç–µ–π.

```bash
vault policy write ansible-policy - <<EOF
path "ansible/*" {
  capabilities = ["read"]
}
EOF
```

- –ü–æ–ª–∏—Ç–∏–∫–∞ `ansible-policy` —Ä–∞–∑—Ä–µ—à–∞–µ—Ç **—Ç–æ–ª—å–∫–æ —á—Ç–µ–Ω–∏–µ** (`read`) –ø–æ –ª—é–±–æ–º—É –ø—É—Ç–∏ –≤–Ω—É—Ç—Ä–∏ `ansible/`.
- –≠—Ç–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ø—Ä–∏–Ω—Ü–∏–ø—É **–º–∏–Ω–∏–º–∞–ª—å–Ω—ã—Ö –ø—Ä–∏–≤–∏–ª–µ–≥–∏–π**.

–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–ª–∏—Ç–∏–∫—É –º–æ–∂–Ω–æ –∫–æ–º–∞–Ω–¥–æ–π:

```bash
vault policy read ansible-policy
```

---

### 1.4. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ AppRole-–∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

AppRole ‚Äî —ç—Ç–æ –º–µ—Ö–∞–Ω–∏–∑–º –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏, –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–π –¥–ª—è –º–∞—à–∏–Ω –∏ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º (–≤ –æ—Ç–ª–∏—á–∏–µ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –º–µ—Ç–æ–¥–æ–≤, —Ç–∞–∫–∏—Ö –∫–∞–∫ LDAP –∏–ª–∏ GitHub).

#### –í–∫–ª—é—á–∞–µ–º AppRole:

```bash
vault auth enable approle
```

#### –°–æ–∑–¥–∞—ë–º —Ä–æ–ª—å –¥–ª—è Ansible:

```bash
vault write auth/approle/role/ansible-role \
  policies="ansible-policy" \
  token_ttl="1h" \
  token_max_ttl="4h"
```

- `policies="ansible-policy"` ‚Äî –ø—Ä–∏–≤—è–∑—ã–≤–∞–µ—Ç —Ä–æ–ª—å –∫ —Å–æ–∑–¥–∞–Ω–Ω–æ–π –ø–æ–ª–∏—Ç–∏–∫–µ.
- `token_ttl` ‚Äî –≤—Ä–µ–º—è –∂–∏–∑–Ω–∏ –≤—ã–¥–∞–Ω–Ω–æ–≥–æ —Ç–æ–∫–µ–Ω–∞ (1 —á–∞—Å).
- `token_max_ttl` ‚Äî –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –∂–∏–∑–Ω–∏ —Ç–æ–∫–µ–Ω–∞ (4 —á–∞—Å–∞), –¥–∞–∂–µ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏.

> ‚ö†Ô∏è **–í–∞–∂–Ω–æ**: –ù–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `token_type=batch` –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ, –µ—Å–ª–∏ –≤–∞–º –Ω–µ –Ω—É–∂–Ω–∞ –≤—ã—Å–æ–∫–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –±–µ–∑ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –æ—Ç–∑—ã–≤–∞ —Ç–æ–∫–µ–Ω–∞. –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `service`-—Ç–æ–∫–µ–Ω—ã, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–∂–Ω–æ –æ—Ç–æ–∑–≤–∞—Ç—å.

–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–æ–ª–∏:

```bash
vault read auth/approle/role/ansible-role
```

---

### 1.5. –ü–æ–ª—É—á–µ–Ω–∏–µ —É—á—ë—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö —Ä–æ–ª–∏ (Role ID –∏ Secret ID)

AppRole –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –¥–≤–∞ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞:

- **Role ID** ‚Äî –ø—É–±–ª–∏—á–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Ä–æ–ª–∏ (–∞–Ω–∞–ª–æ–≥ –ª–æ–≥–∏–Ω–∞).
- **Secret ID** ‚Äî —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á (–∞–Ω–∞–ª–æ–≥ –ø–∞—Ä–æ–ª—è), –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–Ω–æ –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –º–Ω–æ–≥–æ–∫—Ä–∞—Ç–Ω–æ.

#### –ü–æ–ª—É—á–∞–µ–º Role ID:

```bash
vault read auth/approle/role/ansible-role/role-id
```

–ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞:

```
Key        Value
---        -----
role_id    95b272fa-e628-a4f2-74b1-2c9713bab027
```

#### –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º Secret ID:

```bash
vault write -f auth/approle/role/ansible-role/secret-id
```

–ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞:

```
Key                   Value
---                   -----
secret_id             e3f2e2ad-9036-406d-5da2-234947d40c8f
secret_id_accessor    e2c4991f-c88e-f2ed-b2ef-171b1054ba58
```

> üîê **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: Secret ID –¥–æ–ª–∂–µ–Ω —Ö—Ä–∞–Ω–∏—Ç—å—Å—è –≤ –∑–∞—â–∏—â—ë–Ω–Ω–æ–º –º–µ—Å—Ç–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤ CI/CD-–ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö, HashiCorp Vault itself, –∏–ª–∏ –º–µ–Ω–µ–¥–∂–µ—Ä–µ —Å–µ–∫—Ä–µ—Ç–æ–≤). –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –∫–æ–º–º–∏—Ç—å—Ç–µ –µ–≥–æ –≤ Git!

---

## ü§ñ –ß–∞—Å—Ç—å 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Ansible –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Vault

### 2.1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

Ansible –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Python-–±–∏–±–ª–∏–æ—Ç–µ–∫—É `hvac` –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å Vault, –∞ —Ç–∞–∫–∂–µ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—É—é –∫–æ–ª–ª–µ–∫—Ü–∏—é –æ—Ç —Å–æ–æ–±—â–µ—Å—Ç–≤–∞.

#### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ `hvac`:

```bash
pip3 install hvac
```

> –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–∞ –∂–µ –≤–µ—Ä—Å–∏—è Python, —á—Ç–æ –∏ –≤ –≤–∞—à–µ–º –æ–∫—Ä—É–∂–µ–Ω–∏–∏ Ansible.

#### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ `community.hashi_vault`:

```bash
ansible-galaxy collection install community.hashi_vault
```

–≠—Ç–∞ –∫–æ–ª–ª–µ–∫—Ü–∏—è –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç **lookup-–ø–ª–∞–≥–∏–Ω** `hashi_vault`, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∑–≤–æ–ª—è–µ—Ç –∏–∑–≤–ª–µ–∫–∞—Ç—å —Å–µ–∫—Ä–µ—Ç—ã –ø—Ä—è–º–æ –≤ –ø–ª–µ–π–±—É–∫–∞—Ö.

---

### 2.2. –ü–µ—Ä–µ–¥–∞—á–∞ —É—á—ë—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤ Ansible

–°—É—â–µ—Å—Ç–≤—É–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–ø–æ—Å–æ–±–æ–≤ –ø–µ—Ä–µ–¥–∞—Ç—å `role_id` –∏ `secret_id` –≤ Ansible. –ù–∞–∏–±–æ–ª–µ–µ –±–µ–∑–æ–ø–∞—Å–Ω—ã–π ‚Äî —á–µ—Ä–µ–∑ **–ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è** –∏–ª–∏ **Ansible Vault**.

#### –í–∞—Ä–∏–∞–Ω—Ç: —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
export VAULT_ROLE_ID=95b272fa-e628-a4f2-74b1-2c9713bab027
export VAULT_SECRET_ID=e3f2e2ad-9036-406d-5da2-234947d40c8f
```

> üí° **–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞**: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `.env`-—Ñ–∞–π–ª —Å `source .env` –∏–ª–∏ –ø–µ—Ä–µ–¥–∞–≤–∞–π—Ç–µ —á–µ—Ä–µ–∑ CI/CD (GitHub Actions, GitLab CI –∏ —Ç.–¥.).

---

### 2.3. –ü—Ä–∏–º–µ—Ä –ø–ª–µ–π–±—É–∫–∞ —Å –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ–º —Å–µ–∫—Ä–µ—Ç–æ–≤

```yaml
---
- name: Configure Nexus server using secrets from HashiCorp Vault
  hosts: nexus-server
  become: true
  vars:
    # URL –≤–∞—à–µ–≥–æ Vault-—Å–µ—Ä–≤–µ—Ä–∞
    vault_url: "http://localhost:8200"

    # –ü–æ–ª—É—á–∞–µ–º Role ID –∏ Secret ID –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
    role_id: "{{ lookup('env', 'VAULT_ROLE_ID') }}"
    secret_id: "{{ lookup('env', 'VAULT_SECRET_ID') }}"

    # –ò–∑–≤–ª–µ–∫–∞–µ–º —Å–µ–∫—Ä–µ—Ç –∏–∑ Vault
    nexus_secret: >-
      {{
        lookup(
          'community.hashi_vault.hashi_vault',
          'secret=ansible/nexus',
          'auth_method=approle',
          'role_id=' + role_id,
          'secret_id=' + secret_id,
          'url=' + vault_url
        )
      }}

    # –†–∞—Å–ø–∞–∫–æ–≤—ã–≤–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏—è
    nexus_username: "{{ nexus_secret.nexus_username }}"
    nexus_password: "{{ nexus_secret.nexus_password }}"

  tasks:
    - name: Display Nexus credentials (for demo only!)
      debug:
        msg: "Username: {{ nexus_username }}, Password: {{ nexus_password }}"

    # –ü—Ä–∏–º–µ—Ä: —Å–æ–∑–¥–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ —Å —É—á—ë—Ç–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
    - name: Create Nexus auth file
      copy:
        content: |
          username={{ nexus_username }}
          password={{ nexus_password }}
        dest: /etc/nexus/auth.conf
        mode: '0600'
```

> ‚ö†Ô∏è **–í–∞–∂–Ω–æ**: –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –≤—ã–≤–æ–¥–∏—Ç–µ —Å–µ–∫—Ä–µ—Ç—ã –≤ –ª–æ–≥–∏ (`debug`, `stdout`) –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ! –ü—Ä–∏–º–µ—Ä –≤—ã—à–µ ‚Äî —Ç–æ–ª—å–∫–æ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏.

---

## üîê –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

1. **–ù–µ —Ö—Ä–∞–Ω–∏—Ç–µ —Å–µ–∫—Ä–µ—Ç—ã –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏** ‚Äî –Ω–∏ `role_id`, –Ω–∏ `secret_id`, –Ω–∏ –ø–∞—Ä–æ–ª–∏.
2. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ Secret ID** —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–π:
   ```bash
   vault write auth/approle/role/ansible-role/secret-id \
     secret_id_num_uses=10 \
     secret_id_ttl=2h
   ```
3. **–û–≥—Ä–∞–Ω–∏—á—å—Ç–µ CIDR-–¥–∏–∞–ø–∞–∑–æ–Ω—ã**, —Å –∫–æ—Ç–æ—Ä—ã—Ö –º–æ–∂–Ω–æ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å—Å—è:
   ```bash
   vault write auth/approle/role/ansible-role \
     policies="ansible-policy" \
     token_ttl="1h" \
     token_max_ttl="4h" \
     secret_id_bound_cidrs="10.0.0.0/24"
   ```
4. **–ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ –∞—É–¥–∏—Ç-–ª–æ–≥–∏ Vault** ‚Äî –≤–∫–ª—é—á–∏—Ç–µ –∞—É–¥–∏—Ç (`vault audit enable file ...`), —á—Ç–æ–±—ã –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –¥–æ—Å—Ç—É–ø –∫ —Å–µ–∫—Ä–µ—Ç–∞–º.
5. **–†–µ–≥—É–ª—è—Ä–Ω–æ —Ä–æ—Ç–∏—Ä—É–π—Ç–µ Secret ID** ‚Äî –æ—Å–æ–±–µ–Ω–Ω–æ –≤ —Å–ª—É—á–∞–µ –∫–æ–º–ø—Ä–æ–º–µ—Ç–∞—Ü–∏–∏.

---

## üîÑ –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

–•–æ—Ç—è AppRole ‚Äî —Å—Ç–∞–Ω–¥–∞—Ä—Ç –¥–ª—è –º–∞—à–∏–Ω, –≤—ã —Ç–∞–∫–∂–µ –º–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:

- **Token** ‚Äî –µ—Å–ª–∏ —É –≤–∞—Å —É–∂–µ –µ—Å—Ç—å –¥–æ–ª–≥–æ–∂–∏–≤—É—â–∏–π —Ç–æ–∫–µ–Ω (–º–µ–Ω–µ–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ).
- **Kubernetes Auth** ‚Äî –µ—Å–ª–∏ Ansible –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –≤–Ω—É—Ç—Ä–∏ Kubernetes.
- **AWS/GCP Auth** ‚Äî –µ—Å–ª–∏ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ä–∞–∑–º–µ—â–µ–Ω–∞ –≤ –æ–±–ª–∞–∫–µ.

–ü—Ä–∏–º–µ—Ä —Å —Ç–æ–∫–µ–Ω–æ–º:

```yaml
nexus_secret: "{{ lookup('community.hashi_vault.hashi_vault', 'secret=ansible/nexus auth_method=token token=my-vault-token url=http://vault:8200') }}"
```

---

## ‚úÖ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è HashiCorp Vault —Å Ansible –ø–æ–∑–≤–æ–ª—è–µ—Ç:

- –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ —É–ø—Ä–∞–≤–ª—è—Ç—å —Å–µ–∫—Ä–µ—Ç–∞–º–∏.
- –ò–∑–±–µ–≥–∞—Ç—å —Ö—Ä–∞–Ω–µ–Ω–∏—è —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤ –∫–æ–¥–µ.
- –ì–∏–±–∫–æ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞.
- –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏ –∞—É–¥–∏—Ç–∞.

–°–ª–µ–¥—É—è —ç—Ç–æ–π –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏, –≤—ã —Å–º–æ–∂–µ—Ç–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ –∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Vault –≤ —Å–≤–æ–∏—Ö –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è—Ö.

---

> üìö **–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã**:
> - [HashiCorp Vault Documentation](https://developer.hashicorp.com/vault/docs)
> - [Ansible HashiCorp Vault Lookup Plugin](https://docs.ansible.com/ansible/latest/collections/community/hashi_vault/hashi_vault_lookup.html)
> - [AppRole Auth Method Guide](https://developer.hashicorp.com/vault/docs/auth/approle)
